import express from "express";
import mongoose from "mongoose";
import cors from "cors";
import "dotenv/config";

const app = express();
app.use(express.json());
app.use(cors());

const PORT = process.env.PORT || 5000;
const MONGO_URI = process.env.MONGO_URI;

// MongoDB Schema
const userSchema = new mongoose.Schema({ username: { type: String, unique: true } });
const User = mongoose.model("User", userSchema);

// Registrierung / Login
app.post("/api/register", async (req,res)=>{
  try{
    const { username } = req.body;
    if(!username) return res.status(400).json({error:"Name erforderlich"});
    let user = await User.findOne({username});
    if(!user) user = await User.create({username});
    const users = await User.find({}, "-_id username");
    return res.json(users);
  }catch(err){return res.status(500).json({error:err.message});}
});

// Alle Benutzer abrufen
app.get("/api/users", async(req,res)=>{
  try{
    const users = await User.find({}, "-_id username");
    return res.json(users);
  }catch(err){return res.status(500).json({error:err.message});}
});

// Start Server
mongoose.connect(MONGO_URI)
.then(()=>app.listen(PORT,()=>console.log(`Server lÃ¤uft auf Port ${PORT}`)))
.catch(err=>console.log(err));